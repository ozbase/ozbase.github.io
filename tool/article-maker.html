<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>OZBASE 記事作成ツール</title>
<style>
body{font-family:system-ui,sans-serif;max-width:900px;margin:20px auto}
input,textarea,button{width:100%;margin:8px 0;padding:8px}
textarea{height:120px}
code{background:#f5f5f5;display:block;padding:10px;white-space:pre-wrap}
button{font-size:16px}
hr{margin:24px 0}
.copy{font-size:13px;width:auto;padding:6px 10px}
.section{margin-bottom:24px}
</style>
</head>
<body>

<h1>記事作成ツール（手入力用）</h1>

<label>記事タイトル</label>
<input id="title">

<label>元記事URL</label>
<input id="source">

<label>サムネイル画像URL（無ければ空）</label>
<input id="thumb">

<label>考察文（AI Analysis）</label>
<textarea id="analysis"></textarea>

<button onclick="generate()">HTMLを生成</button>
<button onclick="download()">/a/ に保存（ダウンロード）</button>

<hr>

<div class="section">
  <h2>生成されるファイル名</h2>
  <code id="filename"></code>
</div>

<div class="section">
  <h2>トップ用カードHTML（index.html に貼る）</h2>
  <button class="copy" onclick="copyText('cardHtml')">カードHTMLをコピー</button>
  <code id="cardHtml"></code>
</div>

<div class="section">
  <h2>記事HTML（/a/ 用・完成形）</h2>
  <button class="copy" onclick="copyText('articleHtml')">記事HTMLをコピー</button>
  <code id="articleHtml"></code>
</div>

<script>
let articleHTML="", fileName="", cardHTML="";

function clean(x){
  return (x||"")
    .replace(/:contentReference\\[[^\\]]*\\]\\{[^\\}]*\\}/g,"")
    .replace(/```/g,"")
    .trim();
}

function generate(){
  const t2 = clean(document.getElementById("title").value);
  const s2 = clean(document.getElementById("source").value);
  const th2 = clean(document.getElementById("thumb").value);
  const a2 = clean(document.getElementById("analysis").value);

  const d=new Date();
  const y=d.getFullYear();
  const m=String(d.getMonth()+1).padStart(2,"0");
  const day=String(d.getDate()).padStart(2,"0");
  const h=String(d.getHours()).padStart(2,"0");
  const min=String(d.getMinutes()).padStart(2,"0");
  const date = `${y}-${m}-${day}`;

  fileName=`${y}${m}${day}-${h}${min}.html`;
  document.getElementById("filename").textContent="a/"+fileName;

  const imgBlock = th2 ? `
<img src="${th2}" alt="">` : ``;

  articleHTML=`<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>${t2}</title>
<meta name="robots" content="index,follow">
<link rel="canonical" href="https://ozbase.github.io/a/${fileName}">
<style>
:root{--bg:#0b0c10;--fg:#e8e8ea;--muted:#9aa0a6;--link:#8ab4f8}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--fg);
font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif;line-height:1.7}
a{color:var(--link);text-decoration:none}
header{position:relative;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.08);text-align:center}
header img{height:32px}
.back{position:absolute;right:16px;top:50%;transform:translateY(-50%);
padding:6px 10px;border-radius:999px;background:rgba(20,24,42,.8);
border:1px solid rgba(255,255,255,.08);font-size:13px;color:var(--fg)}
main{max-width:920px;margin:0 auto;padding:24px 16px 64px}
main img{display:block;max-width:720px;width:100%;max-height:480px;object-fit:cover;margin:20px auto;border-radius:14px}
.src{color:var(--muted);font-size:13px;margin-bottom:20px}
footer{margin-top:40px;padding-top:20px;border-top:1px solid rgba(255,255,255,.08);
color:var(--muted);font-size:12px}
</style>
</head>
<body>

<header>
  <a href="/"><img src="/assets/ozbase-logo.png" alt="ozbase"></a>
  <a href="/" class="back">← Back to Top</a>
</header>

<main>
<h1>${t2}</h1>

<p class="src">
Source:
<a href="${s2}" target="_blank" rel="nofollow noopener">${s2}</a>
</p>

${imgBlock}

<h2>AI Analysis</h2>
${a2.trim().split(/\n\s*\n/).map(p=>`<p>${p.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}</p>`).join("")}

<footer>
  <div>© ${y} ozbase</div>
  <div><a href="/privacy.html">Privacy Policy</a></div>
</footer>
</main>

</body>
</html>`;

  const thumbCard = th2 ? `
  <a href="/a/${fileName}"><img src="${th2}" alt="" style="width:100%;border-radius:12px;margin-bottom:8px;"></a>` : ``;

  cardHTML=`<div class="card">
${thumbCard}
  <h2><a href="/a/${fileName}">${t2}</a></h2>
  <p>AI analysis is published on a separate page.</p>
  <div class="date">${date}</div>
  <div class="src">
    <a href="${s2}" target="_blank">${s2}</a>
  </div>
</div>`;

  document.getElementById("articleHtml").textContent=articleHTML;
  document.getElementById("cardHtml").textContent=cardHTML;
}

function download(){
  if(!articleHTML){alert("先にHTMLを生成してください");return;}
  const blob=new Blob([articleHTML],{type:"text/html"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;
  a.download=fileName;
  a.click();
  URL.revokeObjectURL(url);
}

function copyText(id){
  const text=document.getElementById(id).textContent;
  navigator.clipboard.writeText(text);
  alert("コピーした");
}
</script>

</body>
</html>
